---
title: "Programmation Tour 2023 - Amos"
subtitle: "Détails préliminaires - CONFIDENTIEL"
author: "Bruno Gauthier"
date: 'MAJ `r Sys.Date()`'
output:
  html_document:
    toc: true  
    toc_float: true
    # theme: flatly
    highlight: textmate
    df_print: kable
    self_contained: false
params:
  annee: 2023
  ville: "Amos"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)

here::i_am("guide2023.Rproj")

# Appel des librairies et variables partagées
source(here::here("code","_LibsVars.R"))

# Dates
source(here("code", "_Dates.R"))

# Pour accès aux données du fichier excel Itineraires.xlsx
source(here("code","_import_itineraire.R"))

# Pour accès au graphique d'élévation
source(here("code","graphique_denivele.R"))

# Pour accès aux tracés
parcours <- st_read(here("gpx","output","parcours.shp"))

# Langue
lang <- "FR"

# Edition  (52e en 2022)
edition <-params$annee - 2022 + 52

```


```{r params}

data <- iti_etape$Details %>% 
  select(Etape, 
         Descr_Villes, 
         Descr_km,
         KM_Total, 
         km_neutres = KM_Neutres, 
         nb_tours = Nb_tours,
         km_par_tour = KM_par_tours,
         Distance_Route, 
         Distance_en_circuit, 
         Distance_totale,
         Liens, 
         heure_dep = Départ,
         heure_arr_finale = time_arrivee
         ) %>% 
  # Correction si heure est mal formatée - par exemple : 14:0  
  mutate(heure_dep = str_replace(heure_dep, "(\\d):0$", "\\1:00"),
         heure_arr_finale = str_replace(heure_arr_finale, "(\\d):0$", "\\1:00") )


```

```{r fun_lien_iframe}

lien_iframe <- function(etape){
  
  ## Derniers chiffres de "https://ridewithgps.com/routes/123456789"
  id_RWG <- str_extract(data$Liens[etape], "\\d*$") 
  
  # Création d'un lien de type iframe
  lien <- glue('<iframe src="https://ridewithgps.com/embeds?type=route&id={id_RWG}&metricUnits=true&sampleGraph=true" style="width: 1px; min-width: 100%; height: 700px; border: none;" scrolling="no"></iframe>')
  
  return (lien)
}
```

<br/>

# Tour de l'Abitibi

Voici un aperçu préliminaire de la `r edition`e édition du Tour de l'Abitibi qui se tiendra du `r dates_FR %>% filter(code=="Mar") %>% pull(jsem_jour_mois_an)` au `r dates_FR %>% filter(code=="Dim") %>% pull(jsem_jour_mois_an)` à `r params$ville`. 


<br/>

```{r map_globale, echo = FALSE, eval = TRUE}
# Visualisation
mapview(parcours, 
        lwd = 2.5,
        alpha = 0.7,
        z = "name",
        color = palette.colors(n=7, palette="ggplot2"),
        layer.name = "Étape")
```


<br/>

## `r dates_FR %>% filter(code=="Lun_Av") %>% pull(jsem_jour_mois_an)` - Présentation des équipes et Challenge Sprint

De 17:30 à 20:00, secteur Cathédrale. 

<br/>


```{r}
etape = 1
```


## Étape `r etape` -  `r dates_FR %>% filter(code=="Mar") %>% pull(jsem_jour_mois_an)` - `r data$Descr_Villes[etape]`

 **`r data$Descr_km[etape]`**

- `r data$km_neutres[etape]` km neutralisés au départ   
- Sans circuit d'arrivée


----------------------------------------------------
                                              Heure
----------------- ----------------------------------
Départ                     `r data$heure_dep[etape]`

Arrivée finale      `r data$heure_arr_finale[etape]`
----------------------------------------------------

<br/>


`r lien_iframe(etape)`

<br/>


```{r}
etape = 2
```


## Étape `r etape` -  `r dates_FR %>% filter(code=="Mer") %>% pull(jsem_jour_mois_an)` - `r data$Descr_Villes[etape]`

 **`r data$Descr_km[etape]`**

- `r data$km_neutres[etape]` km neutralisés au départ
- `r data$nb_tours[etape]` tours de circuit d'arrivée long de `r data$km_par_tour[etape]` km

----------------------------------------------------
                                              Heure
----------------- ----------------------------------
Départ                     `r data$heure_dep[etape]`

Arrivée finale      `r data$heure_arr_finale[etape]`
----------------------------------------------------

<br/>

`r lien_iframe(etape)`

<br/>

```{r}
etape = 3
```


## Étape `r etape` -  `r dates_FR %>% filter(code=="Jeu") %>% pull(jsem_jour_mois_an)` AM - `r data$Descr_Villes[etape]`

 **`r data$Descr_km[etape]`**

Premier départ à `r data$heure_dep[etape]`.

Dernières arrivées avant midi.

<br/>

`r lien_iframe(etape)`

<br/>

```{r}
etape = 4
```


## Étape `r dates_FR %>% filter(code=="Jeu") %>% pull(jsem_jour_mois_an)` PM - `r data$Descr_Villes[etape]`

 **`r data$Descr_km[etape]`**

- `r data$km_neutres[etape]` km neutralisés au départ   
- Sans circuit d'arrivée


----------------------------------------------------
                                              Heure
----------------- ----------------------------------
Départ                     `r data$heure_dep[etape]`

Arrivée finale      `r data$heure_arr_finale[etape]`
----------------------------------------------------

<br/>

`r lien_iframe(etape)`

<br/>

```{r}
etape = 5
```


## Étape `r dates_FR %>% filter(code=="Ven") %>% pull(jsem_jour_mois_an)` - `r data$Descr_Villes[etape]`

 **`r data$Descr_km[etape]`**

- `r data$km_neutres[etape]` km neutralisés au départ   
- Sans circuit d'arrivée


----------------------------------------------------
                                              Heure
----------------- ----------------------------------
Départ                     `r data$heure_dep[etape]`

Arrivée finale      `r data$heure_arr_finale[etape]`
----------------------------------------------------

<br/>

`r lien_iframe(etape)`

<br/>

```{r}
etape = 6
```


## Étape `r etape` -  `r dates_FR %>% filter(code=="Sam") %>% pull(jsem_jour_mois_an)` - `r data$Descr_Villes[etape]`

 **`r data$Descr_km[etape]`**

- `r data$km_neutres[etape]` km neutralisés au départ   
- Sans circuit d'arrivée


----------------------------------------------------
                                              Heure
----------------- ----------------------------------
Départ                     `r data$heure_dep[etape]`

Arrivée finale      `r data$heure_arr_finale[etape]`
----------------------------------------------------

<br/>

`r lien_iframe(etape)`

<br/>


```{r}
etape = 7
```


## Étape `r etape` -  `r dates_FR %>% filter(code=="Dim") %>% pull(jsem_jour_mois_an)` - `r data$Descr_Villes[etape]`

**`r data$Descr_km[etape]`**

- `r data$km_neutres[etape]` km neutralisés au départ   
- `r data$nb_tours[etape]` tours de circuit urbain long de `r data$km_par_tour[etape]` km


----------------------------------------------------
                                              Heure
----------------- ----------------------------------
Départ                     `r data$heure_dep[etape]`

Arrivée finale      `r data$heure_arr_finale[etape]`
----------------------------------------------------

<br/>

`r lien_iframe(etape)`

<br/>
<br/>



## Résumé de l'épreuve - Tour de l'Abitibi `r params$anne`

Distance officielle totale : **`r sum(data$Distance_totale)` km**

Distance sur la route : **`r sum(data$Distance_Route)` km**

Distance en circuit d'arrivée / urbain : **`r sum(data$Distance_en_circuit)` km**

Nombre de tours total : **`r sum(data$nb_tours)` tours**

Km neutralisés (non-inclus) : **_`r sum(data$km_neutres)` km_**  

     
         
-------------------------------------------------------------------------------     
    

# Tour de la Relève

## `r dates_FR %>% filter(code=="Sam") %>% pull(jsem_jour_mois_an)` AM

Courses sur route - 8h à 13h30    

Distances variables selon les âges  - Aller-Retour de / vers la Cathédrale d'Amos

<iframe src="https://ridewithgps.com/embeds?type=route&id=39662474&metricUnits=true&sampleGraph=true" style="width: 1px; min-width: 100%; height: 700px; border: none;" scrolling="no"></iframe>

## `r dates_FR %>% filter(code=="Sam") %>% pull(jsem_jour_mois_an)` PM

Sprint et jeux d'habilité de  12h30 à 15h30   

<iframe src="https://ridewithgps.com/embeds?type=route&id=39662449&metricUnits=true&sampleGraph=true" style="width: 1px; min-width: 100%; height: 700px; border: none;" scrolling="no"></iframe>   


## `r dates_FR %>% filter(code=="Dim") %>% pull(jsem_jour_mois_an)` AM

Critérium de 8h à 13h

<iframe src="https://ridewithgps.com/embeds?type=route&id=39662424&metricUnits=true" style="width: 1px; min-width: 100%; height: 550px; border: none;" scrolling="no"></iframe>   




